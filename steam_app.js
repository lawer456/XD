/*
    Project: Steam Hour Bot - NodeJS
    Note: By using this bot i will not be responsible if you edit the code for bad purposes.
    Created by SwayerPT with Love.
*/

const Steam=require("steam-user"),fs=require("fs"),readlineSync=require("readline-sync"),chalk=require("chalk"),SteamCommunity=require("steamcommunity"),client=new Steam,readline=require("readline"),settings={acceptRandomFriendRequests:!1,acceptItemNotify:!0,acceptTradesNotify:!0,acceptReplys:!1,limits:25,restriction:5,games_id:[]};var mobileCode,wstream,version="v1.4.4";console.log(chalk.white.bold.bgBlack("    Steam Hour [Bot]     ")),console.log(chalk.gray.underline("                   "+version)),console.log(chalk.black.bold.bgWhite("      Steam Login        "));var gamesid=readlineSync.question(chalk.gray.bold(" GamesID (comma-separated) ")+": "),username=readlineSync.question(chalk.gray.bold(" Username ")+": "),password=readlineSync.question(chalk.gray.bold(" Password ")+": ",{hideEchoBack:!0}),hasTwoFactorCode=readlineSync.keyInYNStrict(chalk.gray.bold(" Do you have a SteamGuard? ")+": ");hasTwoFactorCode&&(mobileCode=readlineSync.question(chalk.gray.bold(" SteamGuard ")+": ",{hideEchoBack:!0}));var dtiming=new Date,tstamp=Math.floor(Date.now()/1e3),CountGamesUsed=function(e){for(var n=e.Length-1;n>0;n--){var t=Math.floor(Math.random()*(n+1)),o=e[n];e[n]=e[t],e[t]=o}return e};function parseInput(e){return e.split(",").map(e=>parseInt(e.trim()))}function log(e){for(var n=new Date,t=[n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],o=1;o<6;o++)t[o]<10&&(t[o]="0"+t[o]);console.log(" "+t[3]+":"+t[4]+":"+t[5]+" - \x1b[36m%s\x1b[0m","[STEAM] "+e)}function error(e){for(var n=new Date,t=[n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],o=1;o<6;o++)t[o]<10&&(t[o]="0"+t[o]);console.log(" "+t[3]+":"+t[4]+":"+t[5]+" - \x1b[36m%s\x1b[0m","[ERROR] "+e)}function shutdown(e){log(chalk.red("Connection Lost...")),client.logOff(),client.once("disconnected",function(){process.exit(e)}),setTimeout(function(){process.exit(e)},500)}client.logOn({games_id:gamesid,accountName:username,password:password,twoFactorCode:mobileCode}),settings.games_id=parseInput(gamesid),client.on("loggedOn",function(){client.setPersona(Steam.EPersonaState.Away),""===username||""===password?(console.log(chalk.black.bold.bgWhite("    Connection Status    ")),log(chalk.red("Login Denied - Empty fields.")),shutdown()):(console.log(chalk.black.bold.bgWhite("    Connection Status    ")),client.on("accountInfo",function(e,n){log(chalk.green("Logged in as "+e+".")),client.on("vacBans",function(e,n){e>0&&(log(chalk.red("Verified ("+e+") ban"+(1==e?"":"s")+"."+(0==n.length?"":" in "+n.join(", ")))),log(chalk.red("[BOT] not able to proceed with banned games.")),shutdown())})}),log(chalk.yellow("Tip: Use (CTRL + C) to Logout.")),client.gamesPlayed(CountGamesUsed(settings.games_id)))}),fs.existsSync("servers")&&(Steam.servers=JSON.parse(fs.readFileSync("servers")),log(chalk.green("Connecting ..."))),client.on("connected",function(){log(chalk.green("Starting Bot..."))}),client.on("accountLimitations",function(e,n,t,o){console.log(chalk.black.bold.bgWhite("      Initializing       ")),2==o?log(chalk.red("[Invite] canInviteFriends Banned.")):log(chalk.green("Checking Invite Friends ...")),n?log(chalk.red("[Community] Community Banned.")):log(chalk.green("Checking Community ...")),t?log(chalk.red("[Account] Locked Account.")):log(chalk.green("Checking Account ...")),log(chalk.green("Initializing ...")),e?settings.games_id.length<settings.restriction?(log(chalk.blue("This Account is Limited.")),log(chalk.green("[Limited] Currently In-Game "+settings.games_id.length+"."))):(error(chalk.red("Exceeded the limit 5 Games...")),shutdown()):settings.games_id.length<settings.limits?log(chalk.green("Currently In-Game "+settings.games_id+".")):(error(chalk.red("Exceeded the limit 25 Games.")),shutdown())}),client.on("friendRelationship",(e,n)=>{2===n&&settings.acceptRandomFriendRequests?(client.addFriend(e),log(chalk.yellow("You have an invite from "+e+"."))):error(chalk.red("Unable to Accept Requests."))}),client.on("newItems",function(e){settings.acceptItemNotify?e>0&&log(chalk.yellow("You received ("+e+") items in your Inventory.")):error(chalk.red("Unable to Drop."))}),client.on("tradeOffers",function(e,n){settings.acceptTradesNotify?e>0&&log(chalk.yellow("You received ("+e+") Trade Offer from "+n+".")):error(chalk.red("Unable to Trade."))}),client.on("friendMessage",function(e,n){log(chalk.yellow("Received a message from "+e.getSteam3RenderedID()+" saying: "+n)),settings.acceptReplys?("hello"==n&&client.chatMessage(e,"Yoo, wait a moment. ;D"),"play"==n&&client.chatMessage(e,"Not now... i'm making missions"),"Why"==n&&client.chatMessage(e,"Because i'm doing something"),"yo"==n&&client.chatMessage(e,"Yoo, wait a moment ;D"),"Do you want to play?"==n&&client.chatMessage(e,"Not now"),"Whatsup"==n&&client.chatMessage(e,"hey"),"Are you there?"==n&&client.chatMessage(e,"Yes, but i'm leaving... bye"),"..."==n&&client.chatMessage(e,"Not now!"),"yes"==n&&client.chatMessage(e,"Not now!")):error(chalk.red("Unable to Auto-answer."))}),client.on("error",function(e){console.log(chalk.white.bold.bgRed("    Connection Status    ")),e.eresult==Steam.EResult.InvalidPassword?(error(chalk.red("User or Password Wrong.")),shutdown()):e.eresult==Steam.EResult.AlreadyLoggedInElsewhere?(error(chalk.red("Already logged in!")),shutdown()):e.eresult==Steam.EResult.AccountLogonDenied&&(error(chalk.red("SteamGuard is required!")),shutdown())}),process.on("SIGINT",function(){shutdown()});